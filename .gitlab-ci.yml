stages:
  - build
  - deploy

build:
  image: docker:latest
  stage: build
  script:
    - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN registry.gitlab.com 
    - docker build -t registry.gitlab.com/labxp2018/smped-api .
    - docker push registry.gitlab.com/labxp2018/smped-api
  only:
    - master
  tags:
    - docker

deploy:
  image: stackahoy/stackahoy-cli
  stage: deploy
  script:
    - stackahoy deploy --repo="5b95e5f54779cb0e000bd7d8" --token=$STACKAHOY_TOKEN --branch="master"
  only:
    - master
  tags:
    - docker
